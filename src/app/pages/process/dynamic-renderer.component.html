<style>
    .unsupported-control {
        padding: 0.75rem;
        border: 1px dashed #ccc;
        border-radius: 4px;
        background-color: #f9f9f9;
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .unsupported-control span {
        font-size: 0.9rem;
    }

    .output-text {
        background-color: #f0f0f0;
        border: 1px solid #d1d1d1;
    }

    .unknown-field {
        color: #888;
        font-style: italic;
    }

    .p-field {
        margin-bottom: 1rem;
    }

    .p-field label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
    }
</style>
<ng-container *ngIf="node">
    <div class="control-container">
        <!-- Unsupported control types show as text -->
        <ng-container *ngIf="!isSupported()">
            <div class="p-field">
                <label *ngIf="node.label">{{ node.label }}</label>
                <div class="unsupported-control">
                    <span><strong>Control Type:</strong> {{ node.controlType || 'Unknown' }}</span>
                    <span *ngIf="node.binding"><strong>Binding:</strong> {{ node.binding }}</span>
                    <span><strong>Value:</strong> {{ getValue(node.binding) || '(No value)' }}</span>
                </div>
            </div>
        </ng-container>

        <!-- Supported control types -->
        <ng-container *ngIf="isSupported()">
            <!-- Collapsible Panel / Panel / Section -->
            <p-panel *ngIf="['Collapsible Panel','Panel','Section'].includes(node.controlType || '')"
                     [header]="node.label"
                     [toggleable]="true">
                <ng-container *ngFor="let child of node.children">
                    <app-dynamic-renderer [node]="child" [form]="form"></app-dynamic-renderer>
                </ng-container>
            </p-panel>

            <!-- Input Group -->
            <div *ngIf="node.controlType === 'Input Group'" class="p-field">
                <label>{{ node.label }}</label>
                <ng-container *ngFor="let child of node.children">
                    <app-dynamic-renderer [node]="child" [form]="form"></app-dynamic-renderer>
                </ng-container>
            </div>

            <!-- Text Input (Editable) -->
            <div *ngIf="node.controlType === 'Text'" class="p-field">
                <label>{{ node.label }}</label>
                <input
                        pInputText
                        [value]="getValue(node.binding)"
                        (input)="handleInput($event, node.binding)"
                        [placeholder]="node.label"
                        [readonly]="isReadOnly(node.controlType)"
                />
            </div>

            <!-- Output Text (Read-only) -->
            <div *ngIf="node.controlType === 'Output Text'" class="p-field">
                <label *ngIf="node.label">{{ node.label }}</label>
                <input
                        pInputText
                        [value]="getValue(node.binding)"
                        [readonly]="true"
                        class="output-text"
                />
            </div>

            <!-- Button -->
            <div *ngIf="node.controlType === 'Button'" class="p-field">
                <p-button
                        [label]="node.label || 'Button'"
                        (onClick)="onButtonClick(node)"
                        [class]="node.label === 'OK' ? 'p-button-primary' : 'p-button-secondary'">
                </p-button>
            </div>

            <!-- Nodes with null controlType but with children -->
            <ng-container *ngIf="!node.controlType && hasChildren()">
                <ng-container *ngFor="let child of node.children">
                    <app-dynamic-renderer [node]="child" [form]="form"></app-dynamic-renderer>
                </ng-container>
            </ng-container>

            <!-- Nodes with no controlType and no children but with binding -->
            <div *ngIf="!node.controlType && !hasChildren() && node.binding" class="p-field">
                <label>{{ node.label || 'Field' }}</label>
                <input
                        pInputText
                        [value]="getValue(node.binding)"
                        [readonly]="true"
                        class="output-text"
                />
            </div>

            <!-- Nodes with no controlType, no children, and no binding (show as text) -->
            <div *ngIf="!node.controlType && !hasChildren() && !node.binding" class="p-field">
                <label>{{ node.label || 'Unknown Field' }}</label>
                <span class="unknown-field">No binding specified</span>
            </div>
        </ng-container>
    </div>
</ng-container>
<style>
    /* Remove the hidden-field class as we're using type="hidden" instead */
    .value-display {
        display: flex;
        align-items: center;
    }

    .binding-value {
        display: inline-block;
        padding: 0.5rem;
        background-color: #f8f9fa;
        border: 1px solid #ced4da;
        border-radius: 3px;
        min-width: 200px;
        font-family: inherit;
        font-size: 1rem;
        color: #495057;
    }

    .binding-info {
        display: block;
        font-size: 0.8rem;
        color: #6c757d;
        margin-top: 0.25rem;
    }

    .document-list {
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 1rem;
        background-color: #f8f9fa;
    }

    .document-item {
        padding: 0.75rem;
        background-color: #e8f4ff;
        border: 1px solid #b8daff;
        border-radius: 4px;
        margin-top: 0.5rem;
        min-width: 200px;
    }

    .no-documents {
        color: #6c757d;
        font-style: italic;
        margin-top: 0.5rem;
        padding: 0.5rem;
    }

    .output-text {
        background-color: #f0f0f0;
        border: 1px solid #d1d1d1;
        min-width: 200px;
    }

    .unsupported-control {
        padding: 0.75rem;
        border: 1px dashed #ccc;
        border-radius: 4px;
        background-color: #f9f9f9;
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
        min-width: 200px;
    }

    .unsupported-control span {
        font-size: 0.9rem;
    }

    .unknown-field {
        color: #6c757d;
        font-style: italic;
        padding: 0.5rem;
        display: inline-block;
        min-width: 200px;
    }

    .p-field {
        margin-bottom: 1.5rem;
    }

    .p-field label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: #495057;
    }

    /* Make sure all value displays have consistent width */
    .value-display > span,
    .document-item,
    .no-documents,
    .unsupported-control,
    .unknown-field {
        width: 100%;
        max-width: 400px;
        box-sizing: border-box;
    }

    /* Responsive design */
    @media (max-width: 768px) {
        .value-display > span,
        .document-item,
        .no-documents,
        .unsupported-control,
        .unknown-field {
            max-width: 100%;
            min-width: unset;
        }
    }
</style>
<ng-container *ngIf="node">
    <div class="control-container">
        <!-- Unsupported control types show as text -->
        <ng-container *ngIf="!isSupported()">
            <div class="p-field">
                <label *ngIf="node.label">{{ node.label }}</label>
                <div class="unsupported-control">
                    <span><strong>Control Type:</strong> {{ node.controlType || 'Unknown' }}</span>
                    <span *ngIf="node.binding"><strong>Binding:</strong> {{ node.binding }}</span>
                    <span><strong>Value:</strong> {{ getDisplayValue(node.binding) || '(No value)' }}</span>
                </div>
            </div>
        </ng-container>

        <!-- Supported control types -->
        <ng-container *ngIf="isSupported()">
            <!-- Collapsible Panel / Panel / Section -->
            <p-panel *ngIf="['Collapsible Panel','Panel','Section'].includes(node.controlType || '')"
                     [header]="node.label"
                     [toggleable]="true">
                <ng-container *ngFor="let child of node.children">
                    <app-dynamic-renderer [node]="child" [form]="form"></app-dynamic-renderer>
                </ng-container>
            </p-panel>

            <!-- Input Group -->
            <div *ngIf="node.controlType === 'Input Group'" class="p-field">
                <label>{{ node.label }}</label>
                <ng-container *ngFor="let child of node.children">
                    <app-dynamic-renderer [node]="child" [form]="form"></app-dynamic-renderer>
                </ng-container>
            </div>

            <!-- Text Input (Hidden input, show binding value in span) -->
            <div *ngIf="node.controlType === 'Text'" class="p-field">
                <label>{{ node.label }}</label>
                <div class="value-display">
                    <input
                            pInputText
                            [value]="getDisplayValue(node.binding)"
                            [readonly]="true"
                            [type]="'hidden'"
                    />
                    <span class="binding-value">{{ getDisplayValue(node.binding) }}</span>
                </div>
            </div>

            <!-- Output Text (Hidden input, show binding value in span) -->
            <div *ngIf="node.controlType === 'Output Text'" class="p-field">
                <label *ngIf="node.label">{{ node.label }}</label>
                <div class="value-display">
                    <input
                            pInputText
                            [value]="getDisplayValue(node.binding)"
                            [readonly]="true"
                            [type]="'hidden'"
                    />
                    <span class="binding-value">{{ getDisplayValue(node.binding) }}</span>
                </div>
            </div>

            <!-- Button -->
            <div *ngIf="node.controlType === 'Button'" class="p-field">
                <p-button
                        [label]="node.label || 'Button'"
                        (onClick)="onButtonClick(node)"
                        [class]="node.label === 'OK' ? 'p-button-primary' : 'p-button-secondary'">
                </p-button>
            </div>

            <!-- BPM File Uploader (Show as button) -->
            <div *ngIf="node.controlType === 'BPM File Uploader'" class="p-field">
                <label *ngIf="node.label">{{ node.label }}</label>
                <p-button
                        icon="pi pi-upload"
                        label="Upload File"
                        (onClick)="onButtonClick(node)"
                        class="p-button-info">
                </p-button>
                <span *ngIf="node.binding" class="binding-info">Binding: {{ node.binding }}</span>
            </div>

            <!-- BPM Document List (Show as list) -->
            <div *ngIf="node.controlType === 'BPM Document List'" class="p-field">
                <label *ngIf="node.label">{{ node.label }}</label>
                <div class="document-list">
                    <p>Document List</p>
<!--                    <span *ngIf="node.binding" class="binding-info">Binding: {{ node.binding }}</span>-->
                    <div *ngIf="getDisplayValue(node.binding)" class="document-item">
                        {{ getDisplayValue(node.binding) }}
                    </div>
                    <div *ngIf="!getDisplayValue(node.binding)" class="no-documents">
                        No documents available
                    </div>
                </div>
            </div>

            <!-- Nodes with null controlType but with children -->
            <ng-container *ngIf="!node.controlType && hasChildren()">
                <ng-container *ngFor="let child of node.children">
                    <app-dynamic-renderer [node]="child" [form]="form"></app-dynamic-renderer>
                </ng-container>
            </ng-container>

            <!-- Nodes with no controlType and no children but with binding -->
            <div *ngIf="!node.controlType && !hasChildren() && node.binding" class="p-field">
                <label>{{ node.label || 'Field' }}</label>
                <div class="value-display">
                    <input
                            pInputText
                            [value]="getDisplayValue(node.binding)"
                            [readonly]="true"
                            [type]="'hidden'"
                    />
                    <span class="binding-value">{{ getDisplayValue(node.binding) }}</span>
                </div>
            </div>

            <!-- Nodes with no controlType, no children, and no binding (show as text) -->
            <div *ngIf="!node.controlType && !hasChildren() && !node.binding" class="p-field">
                <label>{{ node.label || 'Unknown Field' }}</label>
                <span class="unknown-field">No binding specified</span>
            </div>
        </ng-container>
    </div>
</ng-container>
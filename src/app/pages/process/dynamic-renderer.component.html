<style>
    .hidden-field {
        display: none;
    }

    .binding-value {
        display: inline-block;
        padding: 0.5rem;
        background-color: #f0f0f0;
        border: 1px solid #d1d1d1;
        border-radius: 3px;
        margin-left: 0.5rem;
    }

    .binding-info {
        display: block;
        font-size: 0.8rem;
        color: #666;
        margin-top: 0.25rem;
    }

    .document-list {
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 1rem;
        background-color: #f9f9f9;
    }

    .document-item {
        padding: 0.5rem;
        background-color: #e8f4ff;
        border: 1px solid #b8daff;
        border-radius: 3px;
        margin-top: 0.5rem;
    }

    .no-documents {
        color: #888;
        font-style: italic;
        margin-top: 0.5rem;
    }

    .output-text {
        background-color: #f0f0f0;
        border: 1px solid #d1d1d1;
    }

    .unsupported-control {
        padding: 0.75rem;
        border: 1px dashed #ccc;
        border-radius: 4px;
        background-color: #f9f9f9;
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .unsupported-control span {
        font-size: 0.9rem;
    }

    .unknown-field {
        color: #888;
        font-style: italic;
    }

    .p-field {
        margin-bottom: 1rem;
    }

    .p-field label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
    }
</style>
<ng-container *ngIf="node">
    <div class="control-container">
        <!-- Unsupported control types show as text -->
        <ng-container *ngIf="!isSupported()">
            <div class="p-field">
                <label *ngIf="node.label">{{ node.label }}</label>
                <div class="unsupported-control">
                    <span><strong>Control Type:</strong> {{ node.controlType || 'Unknown' }}</span>
                    <span *ngIf="node.binding"><strong>Binding:</strong> {{ node.binding }}</span>
                    <span><strong>Value:</strong> {{ getDisplayValue(node.binding) || '(No value)' }}</span>
                </div>
            </div>
        </ng-container>

        <!-- Supported control types -->
        <ng-container *ngIf="isSupported()">
            <!-- Collapsible Panel / Panel / Section -->
            <p-panel *ngIf="['Collapsible Panel','Panel','Section'].includes(node.controlType || '')"
                     [header]="node.label"
                     [toggleable]="true">
                <ng-container *ngFor="let child of node.children">
                    <app-dynamic-renderer [node]="child" [form]="form"></app-dynamic-renderer>
                </ng-container>
            </p-panel>

            <!-- Input Group -->
            <div *ngIf="node.controlType === 'Input Group'" class="p-field">
                <label>{{ node.label }}</label>
                <ng-container *ngFor="let child of node.children">
                    <app-dynamic-renderer [node]="child" [form]="form"></app-dynamic-renderer>
                </ng-container>
            </div>

            <!-- Text Input (Hidden - show binding value) -->
            <div *ngIf="node.controlType === 'Text'" class="p-field">
                <label>{{ node.label }}</label>
                <input
                        pInputText
                        [value]="getDisplayValue(node.binding)"
                        (input)="handleInput($event, node.binding)"
                        [placeholder]="node.label"
                        [readonly]="true"
                        [type]="isHiddenField(node.controlType) ? 'hidden' : 'text'"
                        class="hidden-field"
                />
                <span class="binding-value">{{ getDisplayValue(node.binding) }}</span>
            </div>

            <!-- Output Text (Read-only - show binding value) -->
            <div *ngIf="node.controlType === 'Output Text'" class="p-field">
                <label *ngIf="node.label">{{ node.label }}</label>
                <input
                        pInputText
                        [value]="getDisplayValue(node.binding)"
                        [readonly]="true"
                        [type]="isHiddenField(node.controlType) ? 'hidden' : 'text'"
                        class="output-text"
                />
                <span class="binding-value">{{ getDisplayValue(node.binding) }}</span>
            </div>

            <!-- Button -->
            <div *ngIf="node.controlType === 'Button'" class="p-field">
                <p-button
                        [label]="node.label || 'Button'"
                        (onClick)="onButtonClick(node)"
                        [class]="node.label === 'OK' ? 'p-button-primary' : 'p-button-secondary'">
                </p-button>
            </div>

            <!-- BPM File Uploader (Show as button) -->
            <div *ngIf="node.controlType === 'BPM File Uploader'" class="p-field">
                <label *ngIf="node.label">{{ node.label }}</label>
                <p-button
                        icon="pi pi-upload"
                        label="Upload File"
                        (onClick)="onButtonClick(node)"
                        class="p-button-info">
                </p-button>
                <span *ngIf="node.binding" class="binding-info">Binding: {{ node.binding }}</span>
            </div>

            <!-- BPM Document List (Show as list) -->
            <div *ngIf="node.controlType === 'BPM Document List'" class="p-field">
                <label *ngIf="node.label">{{ node.label }}</label>
                <div class="document-list">
                    <p>Document List</p>
                    <span *ngIf="node.binding" class="binding-info">Binding: {{ node.binding }}</span>
                    <div *ngIf="getDisplayValue(node.binding)" class="document-item">
                        {{ getDisplayValue(node.binding) }}
                    </div>
                    <div *ngIf="!getDisplayValue(node.binding)" class="no-documents">
                        No documents available
                    </div>
                </div>
            </div>

            <!-- Nodes with null controlType but with children -->
            <ng-container *ngIf="!node.controlType && hasChildren()">
                <ng-container *ngFor="let child of node.children">
                    <app-dynamic-renderer [node]="child" [form]="form"></app-dynamic-renderer>
                </ng-container>
            </ng-container>

            <!-- Nodes with no controlType and no children but with binding -->
            <div *ngIf="!node.controlType && !hasChildren() && node.binding" class="p-field">
                <label>{{ node.label || 'Field' }}</label>
                <input
                        pInputText
                        [value]="getDisplayValue(node.binding)"
                        [readonly]="true"
                        class="output-text"
                />
                <span class="binding-value">{{ getDisplayValue(node.binding) }}</span>
            </div>

            <!-- Nodes with no controlType, no children, and no binding (show as text) -->
            <div *ngIf="!node.controlType && !hasChildren() && !node.binding" class="p-field">
                <label>{{ node.label || 'Unknown Field' }}</label>
                <span class="unknown-field">No binding specified</span>
            </div>
        </ng-container>
    </div>
</ng-container>
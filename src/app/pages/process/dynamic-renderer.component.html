<ng-container *ngIf="node">
    <!-- Error boundary for each control -->
    <div class="control-container">
        <ng-container *ngIf="node && isSupported()">
            <!-- Collapsible Panel / Panel / Section -->
            <p-panel *ngIf="['Collapsible Panel','Panel','Section'].includes(node.controlType || '')"
                     [header]="node.label"
                     [toggleable]="true">
                <ng-container *ngFor="let child of node.children">
                    <app-dynamic-renderer [node]="child" [form]="form"></app-dynamic-renderer>
                </ng-container>
            </p-panel>

            <!-- Input Group -->
            <div *ngIf="node.controlType === 'Input Group'" class="p-field">
                <label>{{ node.label }}</label>
                <ng-container *ngFor="let child of node.children">
                    <app-dynamic-renderer [node]="child" [form]="form"></app-dynamic-renderer>
                </ng-container>
            </div>

            <!-- Text Input -->
            <div *ngIf="node.controlType === 'Text'" class="p-field">
                <label>{{ node.label }}</label>
                <!-- Change this line: -->
                <input
                        pInputText
                        [value]="getValue(node.binding)"
                        (input)="handleInput($event, node.binding)"
                        [placeholder]="node.label"
                />
            </div>

            <!-- Output Text -->
            <div *ngIf="node.controlType === 'Output Text'" class="p-field">
                <label *ngIf="node.label">{{ node.label }}</label>
                <span class="output-value">{{ getValue(node.binding) || '(No value)' }}</span>
            </div>

            <!-- Button -->
            <p-button *ngIf="node.controlType === 'Button'"
                      [label]="node.label || 'Button'"
                      (onClick)="onButtonClick(node)"
                      [class]="node.label === 'OK' ? 'p-button-primary' : 'p-button-secondary'">
            </p-button>

            <!-- Nodes with null controlType but with children -->
            <ng-container *ngIf="!node.controlType && hasChildren()">
                <ng-container *ngFor="let child of node.children">
                    <app-dynamic-renderer [node]="child" [form]="form"></app-dynamic-renderer>
                </ng-container>
            </ng-container>

            <!-- Nodes with no controlType and no children (display binding info) -->
            <div *ngIf="!node.controlType && !hasChildren() && node.binding" class="p-field">
                <label>{{ node.label || 'Field' }}</label>
                <span class="output-value">{{ getValue(node.binding) || '(No value)' }}</span>
            </div>
        </ng-container>

        <!-- Unsupported control type -->
        <ng-container *ngIf="node && !isSupported()">
            <div class="unsupported-control error-boundary">
                <i class="pi pi-exclamation-triangle error-icon"></i>
                <span>Unsupported control type: <strong>{{ node.controlType }}</strong></span>
            </div>
        </ng-container>

        <ng-template #unsupportedControl>
            <div class="unsupported-control error-boundary">
                <i class="pi pi-exclamation-triangle error-icon"></i>
                <span>Unsupported control type: <strong>{{ node.controlType }}</strong></span>
            </div>
        </ng-template>
    </div>
</ng-container>
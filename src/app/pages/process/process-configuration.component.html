<!-- process-configuration.component.html -->
<style>
    .field {
        margin-bottom: 1.5rem;
    }

    .field label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
    }

    .p-multiselect {
        width: 100%;
    }

    .p-calendar {
        width: 100%;
    }

    .flex.justify-content-end {
        margin-top: 2rem;
        padding-top: 1rem;
        border-top: 1px solid #e5e7eb;
    }

    .configuration-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
    }

    .section-title {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: #3b82f6;
        border-bottom: 2px solid #e5e7eb;
        padding-bottom: 0.5rem;
    }

    .error-message {
        color: #e24c4c;
        font-size: 0.875rem;
        margin-top: 0.25rem;
    }

    .p-invalid .p-calendar {
        border-color: #e24c4c;
    }
</style>

<div class="p-4">
    <p-toast></p-toast>

    <div class="card">
        <h1>Configure Process</h1>

        <div *ngIf="process" class="mt-4">
            <p-card header="Process Details" class="mb-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <strong>Name:</strong> {{ process.name }}
                    </div>
                    <div>
                        <strong>Short Name:</strong> {{ process.shortName }}
                    </div>
                    <div>
                        <strong>Description:</strong> {{ process.description }}
                    </div>
                    <div>
                        <strong>Version:</strong> {{ process.defaultVersion }}
                    </div>
                    <div>
                        <strong>Last Modified:</strong> {{ process.lastModified_on | date: 'medium' }}
                    </div>
                    <div>
                        <strong>Modified By:</strong> {{ process.lastModifiedBy }}
                    </div>
                </div>
            </p-card>

            <!-- Configuration Form -->
            <div class="card mt-4">
                <h3 class="mb-4">Configuration Settings</h3>

                <form (ngSubmit)="saveConfiguration()" class="p-fluid">
                    <!-- Basic Information Section -->
                    <div class="section-title">Basic Information</div>
                    <div class="configuration-grid">
                        <!-- Acronym -->
                        <div class="field">
                            <label for="acronym">Acronym *</label>
                            <input
                                    id="acronym"
                                    type="text"
                                    pInputText
                                    [(ngModel)]="configurationForm.acronym"
                                    name="acronym"
                                    required
                                    class="w-full"
                                    placeholder="Enter process acronym" />
                        </div>

                        <!-- Name -->
                        <div class="field">
                            <label for="name">Name *</label>
                            <input
                                    id="name"
                                    type="text"
                                    pInputText
                                    [(ngModel)]="configurationForm.name"
                                    name="name"
                                    required
                                    class="w-full"
                                    placeholder="Enter process name" />
                        </div>
                    </div>

                    <!-- Archive Settings Section -->
                    <div class="section-title mt-6">Archive Settings</div>
                    <div class="configuration-grid">
                        <!-- Retention Start Date -->
                        <div class="field">
                            <label for="retentionStartDate">Retention Start Date *</label>
                            <p-calendar
                                    id="retentionStartDate"
                                    [(ngModel)]="configurationForm.retentionStartDate"
                                    name="retentionStartDate"
                                    dateFormat="yy-mm-dd"
                                    [showIcon]="true"
                                    [minDate]="minDate"
                                    [readonlyInput]="true"
                                    placeholder="Select start date"
                                    [class]="retentionDateError ? 'p-invalid' : ''"
                                    class="w-full"
                                    (onSelect)="validateRetentionDate()"
                                    (onInput)="validateRetentionDate()"
                                    (onClear)="validateRetentionDate()">
                            </p-calendar>
                            <div *ngIf="retentionDateError" class="error-message">
                                {{ retentionDateError }}
                            </div>
                        </div>

                        <!-- Number Period Archive -->
                        <div class="field">
                            <label for="numberPeriodArch">Archive Period Number</label>
                            <input
                                    id="numberPeriodArch"
                                    type="number"
                                    pInputText
                                    [(ngModel)]="configurationForm.numberPeriodArch"
                                    name="numberPeriodArch"
                                    class="w-full"
                                    placeholder="Enter period number" />
                        </div>

                        <!-- Instance Archive Number -->
                        <div class="field">
                            <label for="instanceArchNumber">Instance Archive Number</label>
                            <input
                                    id="instanceArchNumber"
                                    type="number"
                                    pInputText
                                    [(ngModel)]="configurationForm.instanceArchNumber"
                                    name="instanceArchNumber"
                                    class="w-full"
                                    placeholder="Enter instance number" />
                        </div>
                    </div>

                    <!-- Access Control Section -->
                    <div class="section-title mt-6">Access Control</div>
                    <div class="configuration-grid">
                        <!-- Assigned Groups -->
                        <div class="field">
                            <label for="assignedGroups">Assigned Groups</label>
                            <p-multiSelect
                                    id="assignedGroups"
                                    [(ngModel)]="configurationForm.assignedGroups"
                                    name="assignedGroups"
                                    [options]="allGroups"
                                    optionLabel="name"
                                    [loading]="loadingGroups"
                                    placeholder="Select groups"
                                    display="chip"
                                    class="w-full">
                                <ng-template pTemplate="header">
                                    <div class="p-2">
                                        <div>Available Groups</div>
                                        <div *ngIf="loadingGroups" class="text-sm text-500">Loading groups...</div>
                                    </div>
                                </ng-template>
                            </p-multiSelect>
                        </div>

                        <!-- Assigned Users -->
                        <div class="field">
                            <label for="assignedUsers">Assigned Users</label>
                            <p-multiSelect
                                    id="assignedUsers"
                                    [(ngModel)]="configurationForm.assignedUsers"
                                    name="assignedUsers"
                                    [options]="allUsers"
                                    optionLabel="username"
                                    [loading]="loadingUsers"
                                    placeholder="Select users"
                                    display="chip"
                                    class="w-full">
                                <ng-template pTemplate="header">
                                    <div class="p-2">
                                        <div>Available Users</div>
                                        <div *ngIf="loadingUsers" class="text-sm text-500">Loading users...</div>
                                    </div>
                                </ng-template>
                            </p-multiSelect>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="field mt-6 flex gap-2 justify-content-end">
                        <button
                                pButton
                                type="button"
                                label="Cancel"
                                icon="pi pi-times"
                                (click)="cancel()"
                                class="p-button-secondary"></button>
                        <button
                                pButton
                                type="submit"
                                label="Configure"
                                icon="pi pi-cog"
                                [loading]="saving"
                                class="p-button-primary"></button>
                    </div>
                </form>
            </div>
        </div>

        <div *ngIf="!process" class="text-center p-4">
            <p>Loading process data...</p>
            <p-progressSpinner *ngIf="!process"></p-progressSpinner>
        </div>
    </div>
</div>